<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SupeGame</title>
<script src="storyData.js"></script>
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon.png" type="image/x-icon">
  

<style>
  body {
    font-family: "Poppins", sans-serif;
    background:#e9e9ec;
    margin:0;
    padding:0;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
  }

  #game, #homeScreen {
    width: 90vw;
     /* Bigger on mobile */
    background:white;
    border-radius:20px;
    padding:20px;
    box-shadow:0 10px 30px rgba(0,0,0,0.15);
  }

  #game {
    display: none;
  }

  #story {
    min-height:200px;
    margin-bottom:20px;
    font-size:18px;
    line-height:1.5;
  }

  img, video {
    width:100%;
    border-radius:15px;
    margin-bottom:15px;
  }

  #nameBox {
    font-weight:bold;
    margin-bottom:5px;
    color:#444;
    font-size: 1.1em;
  }

  .choice, #nextBtn, #startBtn {
    width:100%;
    padding:14px;
    margin:8px 0;
    border:none;
    border-radius:12px;
    background:#4a6cf7;
    color:white;
    cursor:pointer;
    transition:0.2s;
    font-size:17px;
  }

  .choice:hover, #nextBtn:hover {
    background:#2b4de0;
  }

  /* ðŸŒŸ MOBILE FIXES */
  @media (max-width: 480px) {
    #game {
      padding:16px;
      border-radius:16px;
    }

    #story {
      font-size:16px;
    }

    .choice, #nextBtn {
      padding:12px;
      font-size:16px;
    }
  }
</style>
</head>

<body>

<!-- HOME SCREEN -->
<div id="homeScreen">
  <h2>Welcome to the Story Mode Game</h2>
  <p style="font-size:16px; line-height:1.5; color:#444;">
    This game is a <b>story-mode adventure</b>.<br><br>
    To understand the story, read the dialogues and choose your actions.<br><br>
    <b>Your choices will change the outcome of the story.</b>
  </p>

  <button id="startBtn">Start Game</button>
</div>

<!-- GAME SCREEN -->
<div id="game">
  <div id="story"></div>
  <div id="choices"></div>
</div>

<script>
let player = { name: "Hero", xp: 0, items: [], flags: {} };
let currentScene = null;
let dialogueIndex = 0;

// Background music
const bgMusic = new Audio("bgmusic.mp3");
bgMusic.loop = true;
bgMusic.volume = 0.5;

// Start button
document.getElementById("startBtn").onclick = () => {
  document.getElementById("homeScreen").style.display = "none";
  document.getElementById("game").style.display = "block";

  bgMusic.play().catch(() => {});
  loadScene("start");
};

// Load scene
function loadScene(key) {
  currentScene = storyData[key];
  dialogueIndex = 0;

  if (currentScene.effects)
      currentScene.effects(player);

  renderMedia();
  showDialogue();
}

// Render image/video/audio
function renderMedia() {
  const d = document.getElementById("story");
  d.innerHTML = "";

  if (currentScene.video)
    d.innerHTML += `<video src="${currentScene.video}" autoplay muted loop></video>`;

  if (currentScene.image)
    d.innerHTML += `<img src="${currentScene.image}">`;

  if (currentScene.audio)
    new Audio(currentScene.audio).play();
}

// Dialogue system
function showDialogue() {
  const d = document.getElementById("story");
  const c = document.getElementById("choices");
  c.innerHTML = "";

  if (dialogueIndex >= (currentScene.dialogue?.length || 0)) {
    showChoices();
    return;
  }

  const line = currentScene.dialogue[dialogueIndex];

  d.innerHTML += `
    <div id="nameBox">${line.name}</div>
    <p>${line.text}</p>
  `;

  const next = document.createElement("button");
  next.id = "nextBtn";
  next.innerText = "Next â†’";
  next.onclick = () => {
    dialogueIndex++;
    renderMedia();
    showDialogue();
  };
  c.appendChild(next);
}

// Show choices
function showChoices() {
  const c = document.getElementById("choices");
  c.innerHTML = "";

  currentScene.choices.forEach(ch => {
    if (ch.condition && !ch.condition(player)) return;
    
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.innerText = ch.text;
    btn.onclick = () => loadScene(ch.next);
    c.appendChild(btn);
  });
}
</script>

</body>
</html>
